`webpack` è¿™ç§ä¸œè¥¿ï¼Œå¤šè¯´ä¸ç»ƒæ²¡å•¥ç”¨ï¼Œæ¥ä¸‹é‡Œæˆ‘ä»¬åˆ©ç”¨ `webpack` æ­å»ºæœ€åŸºç¡€çš„å‰ç«¯å·¥ç¨‹åŒ–é¡¹ç›®ã€‚

å¯ä»¥å®ç°çš„åŠŸèƒ½å¦‚ä¸‹ï¼š

- é›†æˆ `prettier`
- é›†æˆ `eslint`
- é…ç½® `git` æäº¤è§„èŒƒ
- è¯†åˆ« `.css`ã€`.less`ã€`.scss` ã€`sass` æ–‡ä»¶ï¼Œå¹¶ä¸”æ‰“åŒ…åè¿›è¡Œå‹ç¼©
- é›†æˆ `postcss` é¢„å¤„ç†å™¨
- è¯†åˆ«å›¾åƒèµ„æºæ–‡ä»¶ï¼Œå°‘äº 10KB æ—¶è½¬ä¸ºbase64
- `.css` æ–‡ä»¶å•ç‹¬æ‰“åŒ…ï¼Œä¸æ”¾åœ¨é¡µé¢ä¸­çš„ `<style></style>` ä¸­
- `js` ä»£ç å¯å‘åå…¼å®¹
- `css` ä»£ç å‹ç¼©
- ä»£ç åˆ†åŒ…å‹ç¼©

é¡¹ç›®çš„ç›®å½•å¦‚ä¸‹ï¼š

```shell
â”œâ”€â”€ commitlint.config.js
â”œâ”€â”€ dist
â”œâ”€â”€ node_modules
â”œâ”€â”€ package.json
â”œâ”€â”€ pnpm-lock.yaml
â”œâ”€â”€ public
â”‚Â Â  â””â”€â”€ index.html
â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ img
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ 01.jpg
â”‚Â Â  â”‚Â Â  â””â”€â”€ 02.jpg
â”‚Â Â  â”œâ”€â”€ index.css
â”‚Â Â  â”œâ”€â”€ index.js
â”‚Â Â  â”œâ”€â”€ index.less
â”‚Â Â  â”œâ”€â”€ index.sass
â”‚Â Â  â””â”€â”€ index.scss
â””â”€â”€ webpack
    â”œâ”€â”€ webpack.comm.config.js
    â”œâ”€â”€ webpack.dev.config.js
    â””â”€â”€ webpack.prod.config.js
```

## æ­å»ºWebpackåŸºç¡€

### åˆå§‹åŒ–é¡¹ç›®

```shell
$ pnpm init
```

### å®‰è£… `webpack`

è¿™é‡Œæˆ‘ä»¬å…ˆå®‰è£…ä½¿ç”¨ `webpack` æ‰€å¿…é¡»çš„åŒ…ï¼Œ`loader` å’Œ `plugin` åœ¨åé¢ä½¿ç”¨çš„æ—¶å€™å†å®‰è£…ã€‚

```shell
$ pnpm add webpack webpack-dev-server webpack-cli -D
```

### åˆ›å»ºé¡¹ç›®æ–‡ä»¶

åœ¨é¡¹ç›®ç›®å½•ä¸­ï¼Œåˆ›å»ºä»¥ä¸‹æ–‡ä»¶ç»“æ„ï¼š

```shell
webpack-project
â”œâ”€â”€ public
â”‚Â Â  â””â”€â”€ index.html
â”œâ”€â”€ src
â”‚Â Â  â””â”€â”€ index.js
â””â”€â”€ webpack
    â”œâ”€â”€ webpack.comm.config.js
    â”œâ”€â”€ webpack.dev.config.js
    â””â”€â”€ webpack.prod.config.js
```

åœ¨ `src` ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª `index.js` æ–‡ä»¶ä½œä¸ºå…¥å£æ–‡ä»¶ã€‚

åœ¨ `public` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`index.html`æ–‡ä»¶ä½œä¸ºé¡µé¢å…¥å£ã€‚

åœ¨ `webpack` ç›®å½•ä¸­å­˜æ”¾ `webpack` é…ç½®ç›¸å…³çš„æ–‡ä»¶ï¼Œå…¶ä¸­ `webpack.comm.config.js` ä»£è¡¨å…¬å…±çš„é…ç½®ï¼Œä¹Ÿå°±æ˜¯å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒéƒ½èƒ½ä½¿ç”¨åˆ°çš„é…ç½®ï¼Œæ¯”å¦‚ `entry` ç­‰ã€‚`webpack.dev.config.js`ä»£è¡¨å’Œå¼€å‘ç¯å¢ƒç›¸å…³çš„é…ç½®ï¼Œæ¯”å¦‚ `devServer` ç­‰ã€‚`webpack.prod.config` ä»£è¡¨å’Œç”Ÿäº§ç¯å¢ƒç›¸å…³çš„é…ç½®ï¼Œæ¯”å¦‚ `output`ç­‰ã€‚

å½“å‰çš„ `webpack` çš„é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š

<!-- tabs:start -->

#### **webpack.comm.config.js**

```js
// webpack/webpack.comm.config.js
const path = require('node:path')
const HtmlWebpackPlugin = require('html-webpack-plugin')

/**
 * @type {import('webpack').Configuration}
 */
module.exports = {
  entry: './src/index.js',
  plugins: [
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, '../public/index.html'),
    }),
  ],
  resolve: {
    extensions: ['.js'],
  },
}

```

#### **webpack.dev.config.js**

```js
// webpack/webpack.dev.config.js
const { merge } = require('webpack-merge')
const webpackCommConfig = require('./webpack.comm.config')

module.exports = merge(webpackCommConfig, {
  mode: 'development',
  devServer: {
    port: 8080,
    hot: true,
  },
  devtool: 'eval-cheap-module-source-map',
})

```

#### **webpack.prod.config.js**

```js
// webpack/webpack.prod.config.js
const path = require('node:path')
const { merge } = require('webpack-merge')
const webpackCommConfig = require('./webpack.comm.config')

module.exports = merge(webpackCommConfig, {
  mode: 'production',
  output: {
    path: path.resolve(__dirname, '../dist'),
    clean: true,
  },
  devtool: 'nosoucrces-source-map',
})

```

<!-- tabs:end -->

### å¤„ç† `css`ç­‰æ ·å¼æ–‡ä»¶

#### **å¤„ç†cssæ–‡ä»¶**

å®‰è£…ä¾èµ–

```shell
$ pnpm add css-loader style-loader mini-css-extract-plugin -D
```

æ¥ä¸‹æ¥æˆ‘ä»¬è¦åˆ†åˆ«æ ¹æ®ä¸åŒçš„ç¯å¢ƒç¼–å†™ `webpack` çš„é…ç½®æ–‡ä»¶ã€‚

12

<!-- tabs:start -->

#### **webpack.dev.config.js**

```js
// webpack/webpack.dev.config.js
module.exports = merge(webpackCommConfig, {
  // ...
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader'],
      },
    ],
  }
})

```

#### **webpack.prod.config.js**

```js
// webpack/webpack.pord.config.js
const MiniCssExtractPlugin = require('mini-css-extract-plugin')

module.exports = merge(webpackCommConfig, {
  // ...
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [MiniCssExtractPlugin.loader, 'css-loader'],
      },
    ],
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: 'css/[name][contenthash:8].css',
    }),
  ]
})

```

<!-- tabs:end -->

#### **å¤„ç†lessæ–‡ä»¶**

å®‰è£…ä¾èµ–

```shell
$ pnpm add less less-loader -D
```

æ¥ä¸‹æ¥æˆ‘ä»¬è¦åˆ†åˆ«æ ¹æ®ä¸åŒçš„ç¯å¢ƒç¼–å†™ `webpack` çš„é…ç½®æ–‡ä»¶ã€‚

<!-- tabs:start -->

#### **webpack.dev.config.js**

```js
// webpack/webpack.dev.config.js
module.exports = merge(webpackCommConfig, {
  // ...
  module: {
    rules: [
      // ...
      {
        test: /\.less$/,
        use: ['style-loader', 'css-loader', 'less-loader'],
      },
    ],
  }
})

```

#### **webpack.prod.config.js**

```js
// webpack/webpack.pord.config.js
module.exports = merge(webpackCommConfig, {
  // ...
  module: {
    rules: [
      // ...
      {
        test: /\.less$/,
        use: [MiniCssExtractPlugin.loader, 'css-loader', 'less-loader'],
      },
    ],
  }
})

```

<!-- tabs:end -->

#### å¤„ç†sass|scssæ–‡ä»¶

å®‰è£…ä¾èµ–

```shell
$ pnpm add sass sass-loader -D
```

æ¥ä¸‹æ¥æˆ‘ä»¬è¦åˆ†åˆ«æ ¹æ®ä¸åŒçš„ç¯å¢ƒç¼–å†™ `webpack` çš„é…ç½®æ–‡ä»¶ã€‚

<!-- tabs:start -->

#### **webpack.dev.config.js**

```js
// webpack/webpack.dev.config.js
module.exports = merge(webpackCommConfig, {
  // ...
  module: {
    rules: [
      // ...
      {
        test: /\.s[ac]ss$/,
        use: ['style-loader', 'css-loader', 'sass-loader'],
      },
    ],
  }
})

```

#### **webpack.prod.config.js**

```js
// webpack/webpack.pord.config.js
module.exports = merge(webpackCommConfig, {
  // ...
  module: {
    rules: [
      // ...
      {
        test: /\.s[ac]ss$/,
        use: [MiniCssExtractPlugin.loader, 'css-loader', 'sass-loader'],
      },
    ],
  }
})

```

<!-- tabs:end -->

#### é›†æˆ postcss

å®‰è£…ä¾èµ–

```shell
$ pnpm add postcss postcss-loader autoprefixer -D
```

æ¥ä¸‹æ¥æˆ‘ä»¬è¦åˆ†åˆ«æ ¹æ®ä¸åŒçš„ç¯å¢ƒç¼–å†™ `webpack` çš„é…ç½®æ–‡ä»¶ã€‚

<!-- tabs:start -->

#### **webpack.dev.config.js**

```js
// webpack/webpack.dev.config.js
module.exports = merge(webpackCommConfig, {
  // ...
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          'style-loader',
          'css-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                // æ·»åŠ  autoprefixer æ’ä»¶
                plugins: [require('autoprefixer')],
              },
            },
          },
        ],
      },
      {
        test: /\.less$/,
        use: [
          'style-loader',
          'css-loader',
          'less-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                // æ·»åŠ  autoprefixer æ’ä»¶
                plugins: [require('autoprefixer')],
              },
            },
          },
        ],
      },
      {
        test: /\.s[ac]ss$/,
        use: [
          'style-loader',
          'css-loader',
          'sass-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                // æ·»åŠ  autoprefixer æ’ä»¶
                plugins: [require('autoprefixer')],
              },
            },
          },
        ],
      },
    ],
  }
})

```

#### **webpack.prod.config.js**

```js
// webpack/webpack.pord.config.js
module.exports = merge(webpackCommConfig, {
  // ...
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                // æ·»åŠ  autoprefixer æ’ä»¶
                plugins: [require('autoprefixer')],
              },
            },
          },
        ],
      },
      {
        test: /\.less$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          'less-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                // æ·»åŠ  autoprefixer æ’ä»¶
                plugins: [require('autoprefixer')],
              },
            },
          },
        ],
      },
      {
        test: /\.s[ac]ss$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          'sass-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                // æ·»åŠ  autoprefixer æ’ä»¶
                plugins: [require('autoprefixer')],
              },
            },
          },
        ],
      },
    ],
  }
})
```

<!-- tabs:end -->

æˆ–è€…å°† `postcss` çš„æ’ä»¶é…ç½®æ–‡ä»¶å•ç‹¬æ‹å‡ºå»ï¼Œåœ¨é¡¹ç›®çš„æ ¹ç›®å½•åˆ›å»º `postcss.config.js` ã€‚

```js
// postcss.config.js
module.exports = {
  plugins: [require('autoprefixer')]
}
```

ä¹‹ååœ¨ `webpack` çš„å†™æ³•å˜ä¸ºï¼š

<!-- tabs:start -->

#### **webpack.dev.config.js**

```js
// webpack/webpack.dev.config.js
module.exports = merge(webpackCommConfig, {
  // ...
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          'style-loader',
          'css-loader',
          'postcss-loader'
        ],
      },
      {
        test: /\.less$/,
        use: [
          'style-loader',
          'css-loader',
          'less-loader',
          'postcss-loader'
        ],
      },
      {
        test: /\.s[ac]ss$/,
        use: [
          'style-loader',
          'css-loader',
          'sass-loader',
          'postcss-loader'
        ],
      },
    ],
  }
})

```

#### **webpack.prod.config.js**

```js
// webpack/webpack.pord.config.js
module.exports = merge(webpackCommConfig, {
  // ...
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          'postcss-loader'
        ],
      },
      {
        test: /\.less$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          'less-loader',
          'postcss-loader'
        ],
      },
      {
        test: /\.s[ac]ss$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          'sass-loader',
          'postcss-loader'
        ],
      },
    ],
  }
})
```



<!-- tabs:end -->

#### å‹ç¼©cssä»£ç 

å®‰è£…ä¾èµ–

```shell
$ pnpm add css-minimizer-webpack-plugin -D
```

è¿™ä¸ªæˆ‘ä»¬åªéœ€ç»™ `webpack.prod.config.js` é…ç½®å³å¯ã€‚

```js
// webpack/webpack.prod.config.js
const CssMinimizerPlugin = require('css-minimizer-webpack-plugin')

module.exports = {
  // ....
  optimization: {
    // ä½¿ç”¨æ’ä»¶å‹ç¼©ä»£ç 
    minimize: true,
    minimizer: [new CssMinimizerPlugin(), '...'],
  },
}
```

### æ·»åŠ  `js` ä»£ç å‘åå…¼å®¹

å®‰è£…ä¾èµ–

```shell
$ pnpm add babel-loader @babel/core @babel/preset-env -D
```

ç”±äºå…¼å®¹æ˜¯ä¸åŒºåˆ†ç¯å¢ƒçš„ï¼Œæ— è®ºæ˜¯å¼€å‘è¿˜æ˜¯ç”Ÿäº§ç¯å¢ƒéƒ½åº”è¯¥éœ€è¦ï¼Œå› æ­¤ç›´æ¥å°†è¿™éƒ¨åˆ†ä»£ç æ”¾åˆ° `webpack.comm.config.js` ä¸­å³å¯ã€‚

```js
// webpack/webpack.comm.config.js
module.exports = {
  // ...
  module: {
    rules: [
      {
        test: /\.js$/,
        loader: 'babel-loader',
        exclude: /node_modules/,
        options: {
          presets: ['@babel/preset-env']
        }
      }
    ]
  },
}
```

### è¯»å–å›¾åƒèµ„æºæ–‡ä»¶

åœ¨ `webpack.comm.config.js` ä¸­è®¾ç½®å³å¯ã€‚

```js
// webpack/webpack.comm.config.js
module.exports = {
  // ...
  module: {
    rules: [
      // ... 
      {
        test: /\.(jpe?g|png|gif|webp|svg)$/i,
        type: "asset",
        generator: {
          filename: "images/[hash][ext]",
        },
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024, // 10KB å°äº10kçš„ç›´æ¥è½¬base64
          },
        },
      },
    ]
  }
}
```

### é…ç½®ä»£ç åˆ†å‰²

åœ¨å¼€å‘æ¨¡å¼ä¸‹æˆ‘ä»¬å¹¶ä¸éœ€è¦åˆ‡å‰²ï¼Œå› æ­¤åªéœ€åœ¨ `webpack.pord.config.js` ä¸­é…ç½®ï¼š

```js
// webpack/webpack.prod.config.js
module.exports = {
  // ...
  optimization: {
    // ...
    splitChunks: {
      cacheGroups: {
        chunks: 'all',
        // æŠ½ç¦»node_modulesä¸­çš„å…¬å…±æ¨¡å—
        vendors: {
          test: /[\/]node_modules[\/]/,
          filename: 'vendors.[contenthash].js',
          priority: -10, // è®¾ç½®ä¼˜å…ˆçº§ï¼Œç¡®ä¿å…ˆå¤„ç†è¿™ä¸ªè§„åˆ™
          enforce: true,
          minChunks: 1
        },
        common: {
          chunks: 'all',
          priority: -20,
          filename: 'commons.[contenthash].js',
          minChunks: 2, //è¢«è‡³å°‘2ä¸ªchunkå¼•/ç”¨æ—¶æ‰ä¼šè¢«æå–
          reuseExistingChunk: true //å¦‚æœæ¨¡å—å·²ç»è¢«æ‰“åŒ…è¿›æŸä¸ªchunkï¼Œåˆ™å¤ç”¨è¯¥chunk
        }
      }
    }
  }
}
```

### å¼€å¯ç¼“å­˜

å¯ç”¨æŒä¹…åŒ–æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼Œä»è€Œæ˜¾è‘—æå‡æ„å»ºæ€§èƒ½ã€‚å½“æ­¤é…ç½®å¯ç”¨æ—¶ï¼Œ`Webpack` ä¼šåœ¨é¦–æ¬¡æ„å»ºè¿‡ç¨‹ä¸­å°†æ¨¡å—ã€`chunk` å’Œå†…éƒ¨ç¼–è¯‘æ•°æ®ç»“æ„ï¼ˆå¦‚ `ModuleGraph`ï¼‰ç­‰ä¿¡æ¯åºåˆ—åŒ–åå­˜å‚¨åˆ°ç£ç›˜ä¸Šçš„ç‰¹å®šç›®å½•ä¸­ï¼Œé»˜è®¤ä½ç½®é€šå¸¸æ˜¯ `node_modules/.cache/webpack`ã€‚

```js
// webpack/webpack.comm.config.js
module.exports = {
  // ...
  cache: {
    type: 'filesystem'
  }
}
```



## æ·»åŠ å·¥ç¨‹åŒ–æµç¨‹

### é…ç½® editorconfig

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸Šæ–°å»ºä¸€ä¸ª `.editorconfig` æ–‡ä»¶ï¼Œå†™å…¥é…ç½®ï¼š

```shell
# http://editorconfig.org

root = true

[*] # è¡¨ç¤ºæ‰€æœ‰æ–‡ä»¶é€‚ç”¨
charset = utf-8 # è®¾ç½®æ–‡ä»¶å­—ç¬¦é›†ä¸º utf-8
indent_style = space # ç¼©è¿›é£æ ¼ï¼ˆtab | spaceï¼‰
indent_size = 2 # ç¼©è¿›å¤§å°
end_of_line = lf # æ§åˆ¶æ¢è¡Œç±»å‹(lf | cr | crlf)
trim_trailing_whitespace = true # å»é™¤è¡Œé¦–çš„ä»»æ„ç©ºç™½å­—ç¬¦
insert_final_newline = true # å§‹ç»ˆåœ¨æ–‡ä»¶æœ«å°¾æ’å…¥ä¸€ä¸ªæ–°è¡Œ

[*.md] # è¡¨ç¤ºä»… md æ–‡ä»¶é€‚ç”¨ä»¥ä¸‹è§„åˆ™
max_line_length = off
trim_trailing_whitespace = false
```

### é…ç½® prettier

#### å®‰è£…

```shell
$ pnpm add prettier -D
```

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸Šæ–°å»ºä¸€ä¸ª `.prettierrc` æ–‡ä»¶ï¼Œå†™å…¥è‡ªå®šä¹‰é…ç½®ï¼š

```json
{
  "useTabs": false,
  "tabWidth": 2,
  "printWidth": 80,
  "singleQuote": true,
  "trailingComma": "none",
  "semi": false
}
```

### é…ç½® eslint

#### å®‰è£…

```shell
$ pnpm add eslint -D
```

ç„¶ååœ¨å‘½ä»¤è¡Œè¿è¡Œï¼š

```shell
$ npx eslint --init

# ç„¶åæ ¹æ®ä½ çš„éœ€æ±‚é€‰æ‹©, ä¹‹åé…ç½®eslint
```

#### å¤„ç† prettier å’Œ eslint çš„å†²çª

å®‰è£…å¯¹åº”çš„ä¾èµ–ã€‚

```shell
$ pnpm add eslint-config-prettier eslint-plugin-prettier -D 
```

`eslint.json` é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š

```shell
{
  "env": {
    "browser": true,
    "es2021": true
  },
  "extends": ["eslint:recommended", "prettier"],
  "parserOptions": {
    "ecmaVersion": "latest",
    "sourceType": "module"
  },
  "plugins": ["prettier"],
  "rules": {
    "prettier/prettier": "error",
    "no-undef": "off"
  }
}

```

## æ·»åŠ  `git` æäº¤è§„èŒƒ

### åˆå§‹åŒ–`git`

è¿™æ­¥ä¸å¯å¿½ç•¥ï¼Œåé¢è¦é…ç½®`git`æäº¤è§„èŒƒã€‚

```shell
$ git init
```

ç¼–å†™`.gitignore`ã€‚

```js
node_modules
dist
*.DS_Store
```

### é…ç½®`git`æäº¤è§„èŒƒ

ä½¿ç”¨ `husky-init` å‘½ä»¤å¿«é€Ÿåœ¨é¡¹ç›®åˆå§‹åŒ–ä¸€ä¸ª husky é…ç½®ã€‚åœ¨é…ç½® husky ä¹‹å‰å¿…é¡»åˆå§‹åŒ– gitï¼Œå¦åˆ™å¯èƒ½ä¼šé…ç½®ä¸æˆåŠŸã€‚

```shell
# åˆ‡è®°å…ˆåˆå§‹åŒ–git
$ npx husky-init && pnpm install
```

> å¦‚æœä½¿ç”¨å‘½ä»¤ `rm -rf .git` åˆ é™¤äº† `git` ä»“åº“ï¼Œåˆ™éœ€è¦é‡æ–°æ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ã€‚

å®‰è£…`cz-conventional-changelog`ï¼Œå¹¶ä¸”åˆå§‹åŒ–`cz-conventional-changelog`(æäº¤è§„èŒƒ)ã€‚

```shell
$ pnpm add commitizen cz-conventional-changelog @commitlint/cli @commitlint/config-conventional -D
```

åœ¨ `package.json` ä¸­æ·»åŠ ã€‚

```js
"config": {
  "commitizen": {
    "path": "./node_modules/cz-conventional-changelog"
  }
}
```

åœ¨æ ¹ç›®å½•åˆ›å»º`commitlint.config.js`æ–‡ä»¶ã€‚

```js
module.exports = {
  extends: ['@commitlint/config-conventional']
}
```

æ„å»ºå’Œåˆå§‹åŒ–æäº¤è§„èŒƒä¹‹åï¼Œ`git add`ä¹‹åï¼Œä¸å†ä½¿ç”¨`git commit`æäº¤ï¼Œè€Œæ˜¯ä½¿ç”¨ `npx cz`æˆ–åœ¨`script`è„šæœ¬ä¸­æ·»åŠ `commit: cz`ã€‚

å¼ºåˆ¶æäº¤é£æ ¼ï¼Œä¸ç„¶è§„åˆ™æäº¤æŠ¥é”™ã€‚

```shell
npx husky add .husky/commit-msg '
echo "\nğŸš€ ~ è¯·ä½¿ç”¨æäº¤è§„èŒƒæ¥æäº¤ä»£ç "\\n\\n
npx --no-install commitlint --edit "$1"'
```

## JSç‰ˆæ·»åŠ Jest

å®‰è£…ä¾èµ–

```shell
$ pnpm add -D jest @types/jest 
```

å®‰è£… `@types/jest` çš„ç›®çš„æ˜¯æ·»åŠ è¯­æ³•æç¤º

åˆå§‹åŒ– `Jest` é…ç½®

```shell
$ npx jest --init
```

ç„¶åæ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©å³å¯ï¼Œç„¶åå°±ä¼šåœ¨æ ¹ç›®å½•ç”Ÿæˆ `jest.config.js` æ–‡ä»¶



## JSç‰ˆ webpack é…ç½®é¡¹æ€»ç»“

<!-- tabs:start -->

#### **webpack.comm.config.js**

```js
const path = require('node:path')
const HtmlWebpackPlugin = require('html-webpack-plugin')

/**
 * @type {import('webpack').Configuration}
 */
module.exports = {
  entry: './src/index.js',
  module: {
    rules: [
      {
        test: /\.js$/,
        loader: 'babel-loader',
        exclude: /node_modules/,
        options: {
          presets: ['@babel/preset-env']
        }
      },
      {
        test: /\.(jpe?g|png|gif|webp|svg)$/i,
        type: 'asset',
        generator: {
          filename: 'images/[hash][ext]'
        },
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024 // 10KB å°äº10kçš„ç›´æ¥è½¬base64
          }
        }
      }
    ]
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, '../public/index.html')
    })
  ],
  resolve: {
    extensions: ['.js']
  },
  cache: {
    type: 'filesystem'
  }
}

```



#### **webpack.dev.config.js**

```js
const { merge } = require('webpack-merge')
const webpackCommConfig = require('./webpack.comm.config')

module.exports = merge(webpackCommConfig, {
  mode: 'development',
  devServer: {
    port: 8080,
    hot: true
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          'style-loader',
          'css-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                // æ·»åŠ  autoprefixer æ’ä»¶
                plugins: [require('autoprefixer')]
              }
            }
          }
        ]
      },
      {
        test: /\.less$/,
        use: [
          'style-loader',
          'css-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                // æ·»åŠ  autoprefixer æ’ä»¶
                plugins: [require('autoprefixer')]
              }
            }
          },
          'less-loader'
        ]
      },
      {
        test: /\.s[ac]ss$/,
        use: [
          'style-loader',
          'css-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                // æ·»åŠ  autoprefixer æ’ä»¶
                plugins: [require('autoprefixer')]
              }
            }
          },
          'sass-loader'
        ]
      }
    ]
  },
  devtool: 'eval-cheap-module-source-map'
})

```



#### **webpack.prod.config.js**

```js
const path = require('node:path')
const { merge } = require('webpack-merge')
const webpackCommConfig = require('./webpack.comm.config')
const MiniCssExtractPlugin = require('mini-css-extract-plugin')
const CssMinimizerPlugin = require('css-minimizer-webpack-plugin')

module.exports = merge(webpackCommConfig, {
  mode: 'production',
  output: {
    path: path.resolve(__dirname, '../dist'),
    filename: 'js/[name][contenthash:8].js',
    clean: true
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                // æ·»åŠ  autoprefixer æ’ä»¶
                plugins: [require('autoprefixer')]
              }
            }
          }
        ]
      },
      {
        test: /\.less$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                // æ·»åŠ  autoprefixer æ’ä»¶
                plugins: [require('autoprefixer')]
              }
            }
          },
          'less-loader'
        ]
      },
      {
        test: /\.s[ac]ss$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                // æ·»åŠ  autoprefixer æ’ä»¶
                plugins: [require('autoprefixer')]
              }
            }
          },
          'sass-loader'
        ]
      }
    ]
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: 'css/[name][contenthash:8].css'
    })
  ],
  optimization: {
    // ä½¿ç”¨æ’ä»¶å‹ç¼©ä»£ç 
    minimize: true,
    // æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå‹ç¼©æ’ä»¶ï¼Œæ¥å¯¹æ‰“åŒ…åçš„æ–‡ä»¶ä½œç›¸å…³å‹ç¼©ï¼Œä¸è¿‡ä¼šè¦†ç›–é»˜è®¤çš„æ’ä»¶
    // ä¹Ÿå°±æ˜¯ï¼Œè¿™æ ·è®¾ç½®åï¼ŒCSSä»£ç ç¡®å®å‹ç¼©ï¼Œä½†æ˜¯JSä»£ç ç¡®æ²¡æœ‰è¢«å‹ç¼©äº†
    minimizer: [new CssMinimizerPlugin(), '...'],
    splitChunks: {
      cacheGroups: {
        chunks: 'all',
        // æŠ½ç¦»node_modulesä¸­çš„å…¬å…±æ¨¡å—
        vendors: {
          test: /[\/]node_modules[\/]/,
          filename: 'vendors.[contenthash].js',
          priority: -10, // è®¾ç½®ä¼˜å…ˆçº§ï¼Œç¡®ä¿å…ˆå¤„ç†è¿™ä¸ªè§„åˆ™
          enforce: true,
          minChunks: 1
        },
        common: {
          chunks: 'all',
          priority: -20,
          filename: 'commons.[contenthash].js',
          minChunks: 2, //è¢«è‡³å°‘2ä¸ªchunkå¼•/ç”¨æ—¶æ‰ä¼šè¢«æå–
          reuseExistingChunk: true //å¦‚æœæ¨¡å—å·²ç»è¢«æ‰“åŒ…è¿›æŸä¸ªchunkï¼Œåˆ™å¤ç”¨è¯¥chunk
        }
      }
    }
  },
  devtool: 'nosources-source-map'
})

```

<!-- tabs:end -->

## JSç‰ˆ package.json ä¸­çš„ scripts æ€»ç»“

```json
// package.json
{
  // ...
  "scripts": {
    "dev": "webpack serve --config webpack/webpack.dev.config.js",
    "build": "webpack --config webpack/webpack.prod.config.js",
    "preview": "http-server dist -p 5300 -o",
    "lint": "eslint ./src/**.js --fix",
    "prettier": "prettier --write ./src",
    "prepare": "husky install",
    "commit": "cz",
    "test": "jest --detectOpenHandles"
  }
}
```



> å½“å‰æ¡ˆä¾‹å®Œæ•´çš„å®Œæ•´ä»£ç åœ°å€ï¼šhttps://github.com/xinxin1228/webpack-actual/tree/main/01_%E6%90%AD%E5%BB%BA%E5%9F%BA%E7%A1%80%E7%9A%84%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83_js%E7%89%88

## æ·»åŠ  TypeScript

å®‰è£…ä¾èµ–

```shell
$ pnpm add typescript ts-loader -D
```

ç”Ÿæˆ `tsconfig.json` æ–‡ä»¶ï¼Œç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ï¼š

```shell
$ tsc --init
```

ç„¶åæ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡Œä¿ç•™å’Œæ›´æ”¹é…ç½®é¡¹ï¼Œè¿™é‡Œæ˜¯æˆ‘ç”¨çš„é…ç½®é¡¹å†…å®¹ï¼š

```json
{
  "compilerOptions": {
    "target": "ES2015",
    "allowJs": true,
    "noImplicitAny": true,
    "moduleResolution": "node",
    "module": "ESNext",
    "esModuleInterop": true,
    "resolveJsonModule": true
  },
  "include": ["src/**/*.ts", "src/**/*.d.ts"],
  "exclude": ["node_modules"]
}
```

é…ç½® `webpack`ã€‚

```js
// webpack/webpack.comm.config.js
module.exports = {
  // ...
  module: {
    rules: [
      // ...
      {
        test: /\.ts$/,
        use: 'ts-loader',
        exclude: /node_modules/
      }
    ]
  }
}
```

ç„¶ååœ¨ `src` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `types.d.ts` ç±»å‹å£°æ˜æ–‡ä»¶ã€‚

```js
// src/types.d.ts
// æ”¯æŒå„ç§å›¾ç‰‡
declare module '*.png'
declare module '*.jpg'
declare module '*.jpeg'
declare module '*.gif'
declare module '*.svg'
```

## é…ç½®è·¯å¾„åˆ«å

é¦–å…ˆåœ¨ `tsconfig.json` è¿›è¡Œé…ç½®ï¼Œè¿™æ ·å¯ä»¥ä½¿å¾— IDE åœ¨è¾“å…¥è·¯å¾„åˆ«åæ—¶è·å–æç¤ºã€‚

```json
// tsconfig.json
{
  "compilerOptions": {
    "baseUrl": "./src", // ç”¨æ¥è®¾ç½®ä¸‹é¢ paths è·¯å¾„çš„æ ¹è·¯å¾„ã€‚
    "paths": { // ç”¨æ¥è®¾ç½®ç›¸å¯¹åº”çš„è·¯å¾„æ˜ å°„ï¼Œæ•°ç»„ä¸­çš„è·¯å¾„ç›¸å¯¹åº” baseUrl çš„è·¯å¾„ã€‚
      "@main/*": ["main/*"],
      "@utils/*": ["utils/*"]
    }
  }
}
```

è¿™æ ·è™½ç„¶ç¼–è¾‘å™¨å¯ä»¥è¯†åˆ«åˆ°è·¯å¾„ï¼Œå¹¶ä¸”æ‘ä¸‹ `shift` é”®æ—¶å¯ä»¥è¿›è¡Œè·³è½¬ï¼Œä½†æ˜¯é¡¹ç›®è¿è¡Œæˆ–è€…æ‰“åŒ…æ—¶ï¼Œå¹¶ä¸è®¤è¯†è¯¥è·¯å¾„ï¼Œéœ€è¦åœ¨ `webpack` ä¹Ÿè¿›è¡Œè·¯å¾„æ˜ å°„ã€‚

```js
// webpack.comm.config.js
module.export = {
  // ...
  resolve: {
    // ...
    alias: {
      '@utils': path.resolve(__dirname, '../src/utils')
    }
  }
}
```

## TSç‰ˆæ·»åŠ  Jest

`jest`æ˜¯ç”¨æ¥åšå•å…ƒæµ‹è¯•çš„ï¼Œæ¯”å•çº¯çš„åŠŸèƒ½æµ‹è¯•æ›´èƒ½æ›´å¥½çš„å¯¹åŠŸèƒ½è¿›è¡Œè¦†ç›–æµ‹è¯•ã€‚

å®‰è£…ä¾èµ–

```shell
$ pnpm add jest ts-jest @types/jest -D
```

åˆå§‹åŒ– `Jest` é…ç½®

```shell
$ npx ts-jest config:init
```

è¿è¡Œè¯¥å‘½ä»¤åè‡ªåŠ¨åœ¨æ ¹ç›®å½•ä¸Šç”Ÿæˆ `jest.config.js`ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

```js
// jest.config.js
/** @type {import('ts-jest').JestConfigWithTsJest} */
module.exports = {
  preset: 'ts-jest',
  testEnvironment: 'node',
};
```

é…ç½® TypeScriptï¼Œåœ¨`tsconfig.json`æ–‡ä»¶åŒ…å«`jest`çš„ç±»å‹å®šä¹‰

```json
// tsconfig.json
{
  "compilerOptions": {
    "types": ["jest"]
  }
}
```

ä¹‹ååœ¨ `package.json` ä¸­æ·»åŠ æ‰§è¡Œè„šæœ¬

```json
// package.json
{
  // ...
  "scripts": {
    // ...
    "test": "jest --detectOpenHandles"
  }
}
```

å¦‚æœåœ¨ `xxx.test.ts` æ–‡ä»¶ä¸­ä½¿ç”¨äº†è·¯å¾„åˆ«åï¼Œæ¯”å¦‚ä¸‹é¢çš„ `index.test.ts`

```ts
// index.test.ts
import { hi } from '@utils/hi'
```

é‚£ä¹ˆç›´æ¥è¿è¡Œå•å…ƒæµ‹è¯•çš„æ—¶å€™ä¼šæç¤ºæ‰¾ä¸åˆ°è¯¥æ¨¡å—ï¼ŒæŠ¥é”™ä¿¡æ¯ä¸ºï¼š`Cannot find module '@utils/hi' from 'src/test/index.test.ts'`ã€‚

è¿™æ˜¯æˆ‘åªéœ€è¦åœ¨ä¸Šé¢ç”Ÿæˆçš„ `jest.config.ts` æ·»åŠ  `moduleNameMapper`ï¼Œå¦‚ä¸‹ï¼š

```js
// jest.config.js
module.exports = {
  // ...
  moduleNameMapper: {
    '^@utils/(.*)$': '<rootDir>/src/utils/$1',
  },
}

```

åœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†æ­£åˆ™è¡¨è¾¾å¼ `^@/(.*)$` æ¥åŒ¹é…ä»¥ `@utils/` å¼€å¤´çš„è·¯å¾„ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è¿™äº›è·¯å¾„æ˜ å°„åˆ° `src/utils/` ç›®å½•ä¸‹å¯¹åº”çš„è·¯å¾„ä¸­ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ`<rootDir>` å˜é‡è¡¨ç¤ºé¡¹ç›®æ ¹ç›®å½•çš„ç»å¯¹è·¯å¾„ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…åœ¨è·¯å¾„ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„ã€‚

## TSç‰ˆ webpack é…ç½®é¡¹æ€»ç»“

<!-- tabs:start -->

#### **webpack.comm.config.js**

```js
const path = require('node:path')
const HtmlWebpackPlugin = require('html-webpack-plugin')

/**
 * @type {import('webpack').Configuration}
 */
module.exports = {
  entry: './src/index.ts',
  module: {
    rules: [
      {
        test: /\.js$/,
        loader: 'babel-loader',
        exclude: /node_modules/,
        options: {
          presets: ['@babel/preset-env']
        }
      },
      {
        test: /\.(jpe?g|png|gif|webp|svg)$/i,
        type: 'asset',
        generator: {
          filename: 'images/[hash][ext]'
        },
        parser: {
          dataUrlCondition: {
            maxSize: 10 * 1024 // 10KB å°äº10kçš„ç›´æ¥è½¬base64
          }
        }
      },
      {
        test: /\.ts$/,
        use: 'ts-loader',
        exclude: /node_modules/
      }
    ]
  },
  plugins: [
    new HtmlWebpackPlugin({
      template: path.resolve(__dirname, '../public/index.html')
    })
  ],
  resolve: {
    extensions: ['.js', '.ts'],
    alias: {
      '@utils': path.resolve(__dirname, '../src/utils')
    }
  },
  cache: {
    type: 'filesystem'
  }
}

```

#### **webpack.dev.config.js**

```js
const { merge } = require('webpack-merge')
const webpackCommConfig = require('./webpack.comm.config')

module.exports = merge(webpackCommConfig, {
  mode: 'development',
  devServer: {
    port: 8080,
    hot: true
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: ['style-loader', 'css-loader']
      },
      {
        test: /\.less$/,
        use: ['style-loader', 'css-loader', 'less-loader']
      },
      {
        test: /\.s[ac]ss$/,
        use: ['style-loader', 'css-loader', 'sass-loader']
      }
    ]
  },
  devtool: 'eval-cheap-module-source-map'
})

```

#### **webpack.prod.config.js**

```js
const path = require('node:path')
const { merge } = require('webpack-merge')
const webpackCommConfig = require('./webpack.comm.config')
const MiniCssExtractPlugin = require('mini-css-extract-plugin')
const CssMinimizerPlugin = require('css-minimizer-webpack-plugin')

module.exports = merge(webpackCommConfig, {
  mode: 'production',
  output: {
    path: path.resolve(__dirname, '../dist'),
    filename: 'js/[name][contenthash:8].js',
    chunkFilename: 'js/chunk-[name].[contenthash:8].js',
    clean: true
  },
  module: {
    rules: [
      {
        test: /\.css$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                // æ·»åŠ  autoprefixer æ’ä»¶
                plugins: [require('autoprefixer')]
              }
            }
          }
        ]
      },
      {
        test: /\.less$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                // æ·»åŠ  autoprefixer æ’ä»¶
                plugins: [require('autoprefixer')]
              }
            }
          },
          'less-loader'
        ]
      },
      {
        test: /\.s[ac]ss$/,
        use: [
          MiniCssExtractPlugin.loader,
          'css-loader',
          {
            loader: 'postcss-loader',
            options: {
              postcssOptions: {
                // æ·»åŠ  autoprefixer æ’ä»¶
                plugins: [require('autoprefixer')]
              }
            }
          },
          'sass-loader'
        ]
      }
    ]
  },
  plugins: [
    new MiniCssExtractPlugin({
      filename: 'css/[name][contenthash:8].css'
    })
  ],
  optimization: {
    // ä½¿ç”¨æ’ä»¶å‹ç¼©ä»£ç 
    minimize: true,
    // æä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå‹ç¼©æ’ä»¶ï¼Œæ¥å¯¹æ‰“åŒ…åçš„æ–‡ä»¶ä½œç›¸å…³å‹ç¼©ï¼Œä¸è¿‡ä¼šè¦†ç›–é»˜è®¤çš„æ’ä»¶
    // ä¹Ÿå°±æ˜¯ï¼Œè¿™æ ·è®¾ç½®åï¼ŒCSSä»£ç ç¡®å®å‹ç¼©ï¼Œä½†æ˜¯JSä»£ç ç¡®æ²¡æœ‰è¢«å‹ç¼©äº†
    minimizer: [new CssMinimizerPlugin(), '...'],
    splitChunks: {
      cacheGroups: {
        chunks: 'all',
        // æŠ½ç¦»node_modulesä¸­çš„å…¬å…±æ¨¡å—
        vendors: {
          test: /[\/]node_modules[\/]/,
          filename: 'vendors.[contenthash].js',
          priority: -10, // è®¾ç½®ä¼˜å…ˆçº§ï¼Œç¡®ä¿å…ˆå¤„ç†è¿™ä¸ªè§„åˆ™
          enforce: true,
          minChunks: 1
        },
        common: {
          chunks: 'all',
          priority: -20,
          filename: 'commons.[contenthash].js',
          minChunks: 2, //è¢«è‡³å°‘2ä¸ªchunkå¼•/ç”¨æ—¶æ‰ä¼šè¢«æå–
          reuseExistingChunk: true //å¦‚æœæ¨¡å—å·²ç»è¢«æ‰“åŒ…è¿›æŸä¸ªchunkï¼Œåˆ™å¤ç”¨è¯¥chunk
        }
      }
    }
  },
  devtool: 'nosources-source-map'
})

```

<!-- tabs:end -->

## TSç‰ˆ package.json ä¸­çš„ scripts æ€»ç»“

```json
// package.json
{
  // ...
  "scripts": {
    "dev": "webpack serve --config webpack/webpack.dev.config.js",
    "build": "webpack --config webpack/webpack.prod.config.js",
    "preview": "http-server dist -p 5300 -o",
    "lint": "eslint ./src/**.js --fix",
    "prettier": "prettier --write ./src",
    "commit": "cz",
    "prepare": "husky install",
    "test": "jest"
  }
}
```




> å½“å‰æ¡ˆä¾‹å®Œæ•´çš„å®Œæ•´ä»£ç åœ°å€ï¼šhttps://github.com/xinxin1228/webpack-actual/tree/main/02_%E6%90%AD%E5%BB%BA%E5%9F%BA%E7%A1%80%E7%9A%84%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83_ts%E7%89%88
