`Shell`中变量主要分为环境变量和自定义变量两大类。

## 环境变量

通常是系统定义好的，也可以由用户从父 `Shell` 传入子 `Shell`，可以直接使用。

`env`命令或`printenv`命令，可以显示所有环境变量。

```shell
$ env
# 或
$ printenv
```

下面是一些常见的环境变量。

- `BASHPID`：Bash 进程的进程 ID。
- `BASHOPTS`：当前 Shell 的参数，可以用`shopt`命令修改。
- `DISPLAY`：图形环境的显示器名字，通常是`:0`，表示 X Server 的第一个显示器。
- `EDITOR`：默认的文本编辑器。
- `HOME`：用户的主目录。
- `HOST`：当前主机的名称。
- `IFS`：词与词之间的分隔符，默认为空格。
- `LANG`：字符集以及语言编码，比如`zh_CN.UTF-8`。
- `PATH`：由冒号分开的目录列表，当输入可执行程序名后，会搜索这个目录列表。
- `PS1`：Shell 提示符。
- `PS2`： 输入多行命令时，次要的 Shell 提示符。
- `PWD`：当前工作目录。
- `RANDOM`：返回一个0到32767之间的随机数。
- `SHELL`：Shell 的名字。
- `SHELLOPTS`：启动当前 Shell 的`set`命令的参数，参见《set 命令》一章。
- `TERM`：终端类型名，即终端仿真器所用的协议。
- `UID`：当前用户的 ID 编号。
- `USER`：当前用户的用户名。

很多环境变量很少发生变化，而且是只读的，可以视为常量。由于它们的变量名全部都是大写，所以传统上，如果用户要自己定义一个常量，也会使用全部大写的变量名。

**注意，变量名区分大小写。**

我们可以使用`echo`命令来打印输出一个变量的值。

```shell
$ ehco $PWD
/user/home

# 或
$ printenv PWD
```

注意，`printenv`命令后面的变量名，不用加前缀`$`。

## 自定义变量

自定义变量是用户在当前 Shell 里面自己定义的变量，仅在当前 Shell 可用。一旦退出当前 Shell，该变量就不存在了。

`set`命令可以显示所有变量（包括环境变量和自定义变量），以及所有的 Bash 函数。

```shell
$ set
```

### 创建变量

用户创建变量的时候，变量名必须遵守下面的规则。

- 字母、数字和下划线字符组成。
- 第一个字符必须是一个字母或一个下划线，不能是数字。
- 不允许出现空格和标点符号。

变量声明的语法如下。

```shell
variable=value
```

上面命令中，等号左边是变量名，右边是变量。注意，等号两边不能有空格。

如果变量的值包含空格，则必须将值放在引号中。

```shell
foo="hello world"
```

变量没有数据类型的概念，所有的变量值都是**字符串**。

并且变量可以重复赋值，后面的值会覆盖前面的值。

```shell
$ foo=1
$ echo $foo
1
$ foo=$((3*5))
$ echo $foo
15
```

同一行定义多个变量，必须使用分号（`;`）进行分隔。

```shell
$ foo=1;bar=2
```

### 读取变量

读取自定义变量和读取系统变量一致，都是采用`echo`命令读取，并且在变量名称前面加上`$`。

```shell
$ foo=hello
$ echo $foo
hello
```

读取变量的时候，变量名也可以使用花括号`{}`包围，比如`$a`也可以写成`${a}`。这种写法可以用于变量名与其他字符连用的情况。

```shell
$ a=foo
$ echo $a_file
# 这里不会有任何输出，因为会默认将 a_file 解释为变量，因为 a_file 变量不存在，因此会输出 空

$ echo ${a}_file
foo_file
```

如果变量值包含连续空格（或制表符和换行符），最好放在双引号里面读取。

```shell
$ a="1 2  3"
$ echo $a
1 2 3
$ echo "$a"
1 2  3
```

### 删除变量

`unset`命令用来删除一个变量。

```shell
$ unset NAME
```

这个命令不是很有用。因为不存在的 Bash 变量一律等于空字符串，所以即使`unset`命令删除了变量，还是可以读取这个变量，值为空字符串。

所以，删除一个变量，也可以将这个变量设成空字符串。

```shell
$ foo=''
$ foo=
```

上面两种写法，都是删除了变量`foo`。由于不存在的值默认为空字符串，所以后一种写法可以在等号右边不写任何值。

### 输出变量

用户创建的变量仅可用于当前 Shell，子 Shell 默认读取不到父 Shell 定义的变量。为了把变量传递给子 Shell，需要使用`export`命令。这样输出的变量，对于子 Shell 来说就是环境变量。

```shell
$ export PORT=3000

# 在实际开发中 我们经常用来改端口
# 端口改为3000之后启动项目
$ export PORT=3000 && npm start
```

上面命令执行后，当前 Shell 及随后新建的子 Shell，都可以读取变量`$PORT`。

子 Shell 如果修改继承的变量，不会影响父 Shell。

```shell
# 输出变量 $foo
$ export foo=bar

# 新建子 Shell
$ bash

# 读取 $foo
$ echo $foo
bar

# 修改继承的变量
$ foo=baz

# 退出子 Shell
$ exit

# 读取 $foo
$ echo $foo
bar
```

### 变量的默认值

Bash 提供四个特殊语法，跟变量的默认值有关，目的是保证变量不为空。

```shell
${varname:-word}
```

上面语法的含义是，如果变量`varname`存在且不为空，则返回它的值，否则返回`word`。它的目的是返回一个默认值，比如`${count:-0}`表示变量`count`不存在时返回`0`。

```shell
${varname:=word}
```

上面语法的含义是，如果变量`varname`存在且不为空，则返回它的值，否则将它设为`word`，并且返回`word`。它的目的是设置变量的默认值，比如`${count:=0}`表示变量`count`不存在时返回`0`，且将`count`设为`0`。

```shell
${varname:+word}
```

上面语法的含义是，如果变量名存在且不为空，则返回`word`，否则返回空值。它的目的是测试变量是否存在，比如`${count:+1}`表示变量`count`存在时返回`1`（表示`true`），否则返回空值。

```shell
${varname:?message}
```

上面语法的含义是，如果变量`varname`存在且不为空，则返回它的值，否则打印出`varname: message`，并中断脚本的执行。如果省略了`message`，则输出默认的信息“parameter null or not set.”。它的目的是防止变量未定义，比如`${count:?"undefined!"}`表示变量`count`未定义时就中断执行，抛出错误，返回给定的报错信息`undefined!`。

# 